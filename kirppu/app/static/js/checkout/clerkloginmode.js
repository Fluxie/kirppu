// Generated by CoffeeScript 1.7.1
(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  this.ClerkLoginMode = (function(_super) {
    __extends(ClerkLoginMode, _super);

    function ClerkLoginMode(config) {
      ClerkLoginMode.__super__.constructor.call(this, config);
      this._prefix = this.cfg.settings.clerkPrefix;
    }

    ClerkLoginMode.prototype.title = function() {
      return "Locked";
    };

    ClerkLoginMode.prototype.subtitle = function() {
      return "Login...";
    };

    ClerkLoginMode.prototype.initialMenuEnabled = false;

    ClerkLoginMode.prototype.onFormSubmit = function(input) {
      if (input.indexOf(this._prefix) !== 0) {
        return false;
      }
      return Api.clerkLogin(input, this.cfg.settings.counterCode, this);
    };

    ClerkLoginMode.prototype.onResultSuccess = function(data) {
      var username;
      username = data["user"];
      this.cfg.settings.clerkName = username;
      console.log("Logged in as " + username + ".");
      return this.switchTo(CounterMode);
    };

    ClerkLoginMode.prototype.onResultError = function(jqXHR) {
      if (jqXHR.status === 419) {
        console.log("Login failed: " + jqXHR.responseJSON["message"]);
        return;
      }
      return true;
    };

    return ClerkLoginMode;

  })(CheckoutMode);

  this.ModeSwitcher.registerEntryPoint("clerk_login", ClerkLoginMode);

}).call(this);
